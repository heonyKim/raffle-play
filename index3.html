<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BUBAUM ì¶”ì²¨</title>
    <style>
      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: scale(2);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }
      @keyframes finalAnimation {
        0% {
          opacity: 0;
          transform: scale(0.3) rotate(-10deg);
          text-shadow: 0 0 0px rgb(0, 17, 255);
          filter: brightness(0.8) blur(2px);
        }
        50% {
          transform: scale(1.6) rotate(5deg);
          filter: brightness(1.4) blur(0);
        }
        70% {
          transform: scale(1.3) rotate(-3deg);
        }
        100% {
          opacity: 1;
          transform: scale(1.8);
          text-shadow: 0 0 25px rgb(0, 102, 255), 0 0 40px rgb(0, 174, 255);
          filter: brightness(1.8);
        }
      }
      @keyframes confettiFall {
        to {
          transform: translateY(80vh) rotateZ(720deg); /* í™”ë©´ ì•„ë˜ê¹Œì§€ ë‚™í•˜ + ë” ë§ì´ íšŒì „ */
          opacity: 0;
        }
      }
      @keyframes confettiRotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes popFade {
        0% {
          transform: translate(-50%, -50%) scale(0.5) rotate(-5deg);
          opacity: 0;
        }
        30% {
          transform: translate(-50%, -50%) scale(1.3) rotate(3deg);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1) rotate(0deg);
          opacity: 1;
        }
      }
      @font-face {
        font-family: "Pretendard";
        src: url("./Pretendard.ttf") format("truetype"); /* TTF */
        font-weight: 400;
        font-display: swap;
      }
      html,
      body {
        height: 100%;
        background: white;
        color: white;
        font-family: "Pretendard", sans-serif;
        overflow: hidden;
        user-select: none;
      }
      /** ì „ì²´ ë©”ì¸ ì»¨í…Œì´ë„ˆ **/
      .item-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        gap: 1%;
        padding-left: 0.5%;
        padding-right: 0.5%;
      }
      /** ì•„ì´í…œ ì¢Œì¸¡ê³¼ ìš°ì¸¡ ê³µí†µ class **/
      .item {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 250px;
        height: 90%;
        position: relative;
        border-radius: 10px;
        overflow: hidden;
      }

      /** ì¢Œì¸¡ ë¦¬ìŠ¤íŠ¸ **/
      .left {
        box-shadow: 0 0 4px #000;
        border-radius: 10px;
        color: rgb(0, 128, 233);
        font-size: 2.5rem;
        background: white;
        display: flex;
        justify-content: start;
        align-items: center;
        border: none;
        flex-direction: column;
      }

      /** ì¢Œì¸¡ ë‹¹ì²¨ í˜„í™© class ì‹œì‘ --- **/
      .gift-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        padding-top: 20px;
        width: calc(100% - 60px);
        height: calc(100% - 120px);
        column-gap: 30px;
        row-gap: 20px;
      }
      .gift-item {
        background: rgb(219, 219, 219);
        color: rgb(59, 59, 59);
        border-radius: 10px;
        font-size: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .gift-item.special {
        background: rgb(219, 219, 219);
        color: rgb(0, 128, 233);
      }

      .selected-completed {
        border: 1px solid rgb(0, 128, 233) !important;
        background: white !important;
        color: rgb(0, 128, 233) !important;
      }
      .selected {
        background: rgb(0, 128, 233) !important;
        color: white !important;
      }

      /** ìš°ì¸¡ ìŠ¬ë¡¯ ì‹œì‘ ---- **/
      .slot {
        border: none;
        font-size: 18rem;
        border-radius: 10px;
        background: black;
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 4px #000;
      }
      .slot-item {
        font-size: 18rem;
        opacity: 0;
        animation: fadeIn 0.2s ease-out forwards;
        position: absolute;
      }
      .slot-item.final {
        animation: finalAnimation 0.5s ease-out forwards;
        text-shadow: 0 0 5px #00c3ff, 0 0 10px #00f0ff, 0 0 20px #00f0ff;
        animation-timing-function: cubic-bezier(0.19, 1, 0.22, 1); /*ë¦¬ì¹˜í•˜ê²Œ */
      }

      /** ìš°ì¸¡ í˜ì´ì§€ ì²« ì§„ì…ì‹œ íšŒì‚¬ ë¡œê³  ë·° **/
      .before-start {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        color: white;
        z-index: 5;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 50px;
        animation: fadeIn 0.2s ease-out forwards;
        background: rgba(0, 0, 0, 0.5);
      }

      /** í‘¸í„° **/
      .footer {
        position: fixed;
        bottom: 15px;
        left: 20px;
        color: rgb(143, 143, 143);
        z-index: 5;
      }

      /** ì¶•í•˜ìš© ìƒë‹¨ì—ì„œ ë–¨ì–´ì§€ëŠ” íš¨ê³¼ **/
      .confetti-shape.circle {
        border-radius: 50%;
        animation: confettiRotate 1.5s linear forwards;
      }
      .confetti-shape.square {
        animation: confettiRotate 1.5s linear forwards;
      }
      .confetti-shape.triangle {
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-bottom: 12px solid;
        background: none !important;
      }
      .confetti-shape.star::before {
        content: "â˜…";
        font-size: 14px;
        display: block;
        color: inherit;
      }
      .confetti-shape.star {
        width: 14px;
        height: 14px;
        background: none !important;
      }

      /** ì¶•í•˜ ë©”ì‹œì§€ **/
      .congrats-message {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.5);
        font-size: 3rem;
        font-weight: bold;
        color: #ffe600;
        opacity: 0;
        pointer-events: none;
        text-shadow: 0 0 10px #ffcc00, 0 0 20px #ff9900;
        z-index: 100;
        transition: all 0.5s ease-out;
      }
      .congrats-message.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.2) rotate(1deg);
        animation: popFade 1.2s ease-out forwards;
      }
      /** í† ìŠ¤íŠ¸ ë©”ì‹œì§€ **/
      .toast-container {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .toast-item {
        padding: 22px 50px;
        background: rgb(252 86 86);
        color: #fff;
        border-radius: 6px;
        box-shadow: rgba(255, 255, 255, 0.8) 0px 0px 20px;
        opacity: 0;
        font-size: 33px;
        transition: opacity 0.3s ease-in-out;
        position: relative;
      }
    </style>
  </head>
  <body>
    <div class="toast-container" id="toast-container"></div>

    <div class="congrats-message" id="congrats">
      <div>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰</div>
    </div>

    <div class="item-container">
      <div class="item left" style="flex: 1">
        <div style="padding-top: 30px; font-weight: bold; font-size: 30px">
          2025 BUë°”ì›€ ê·¸ë£¹ ì›Œí¬ìƒµ ê²½í’ˆ ì¶”ì²¨
        </div>
        <div class="gift-container" id="gift-container"></div>
      </div>
      <div class="item" style="flex: 2">
        <div class="before-start">BUë°”ì›€</div>
        <div class="slot" id="slot"></div>
      </div>
    </div>
    <div class="footer">
      Created by Fintech team Front Engineer &middot; All rights reserved
    </div>
    <script>
      /**
            1. ì•„ì´í…œì„ ì„ íƒ í›„ ì—”í„°í‚¤ë¡œ ì‹œì‘, ì¢…ë£Œ í•©ë‹ˆë‹¤.
            2. ì‚¬ìš©ìê°€ ì„ íƒì„ í•˜ì§€ ì•Šìœ¼ë©´ ë™ì‘ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            3. ì‚¬ìš©ìê°€ ì—”í„°í‚¤ë¥¼ ëˆŒëŸ¬ì•¼ ë©ˆì¶¥ë‹ˆë‹¤.
            4. í•œë²ˆ ì¶”ì²¨í•œ ë²ˆí˜¸ëŠ” ì œì™¸ë©ë‹ˆë‹¤.
            5. ì¶”ì²¨í•œ ì•„ì´í…œì€ ë‹¤ì‹œ ì„ íƒí•´ì„œ ì¬ ì¶”ì²¨ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            -> ì‚¬ìš©ìê°€ ì•ˆë‚˜ì˜¬ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬
      */
      const toastContainer = document.getElementById("toast-container"); // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ
      const beforeStart = document.querySelector(".before-start"); // ì‹œì‘ ì „ ë¡œê³ 
      const giftContainer = document.getElementById("gift-container"); // ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
      const slot = document.getElementById("slot"); // ë©”ì¸ ìŠ¬ë¡¯(ì£¼ ì—ë‹ˆë©”ì´ì…˜ ì˜ì—­)
      let rolling = false; // ìˆ«ìê°€ ëŒì•„ê°€ëŠ”ì§€ ì—¬ë¶€
      let isStopping = false; // ë©ˆì¶¤ ì•¡ì…˜ì´ ëë‚¬ëŠ”ì§€ ì—¬ë¶€
      let currentTimeout = null; // í˜„ì¬ íƒ€ì´ë¨¸(ìˆ«ìê°€ ëŒì•„ê°€ëŠ”)
      const firstSpeed = 800; // ì´ˆê¸° ì†ë„(ìˆ«ìê°€ ëŒì•„ê°€ëŠ” ì†ë„)
      let currentSpeed = firstSpeed; // í˜„ì¬ ì†ë„(ìˆ«ìê°€ ëŒì•„ê°€ëŠ” ì†ë„)
      const wordsArrayCount = 10; //ì¶”ì²¨ ê°œìˆ˜
      const wordsArray = []; // ì¶”ì²¨ ê°œìˆ˜ì— ë§ëŠ” ë°°ì—´ ìƒì„±
      const endedNumberArray = []; // ì´ë¯¸ ë‹¹ì²¨ëœ ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´

      //ì„ ë¬¼ ì…ë‹ˆë‹¤(name : ì´ë¦„, value : ë°°ì—´ì˜ ì¸ë±ìŠ¤, selected : ì„ íƒ ì—¬ë¶€, isEnd : ë‹¹ì²¨ ì—¬ë¶€)
      const giftBoxes = [
        { name: "ë‹Œí…ë„ ìŠ¤ìœ„ì¹˜", selected: false, value: -1, isEnd: false },
        { name: "ì†Œë‹ˆ ë¬´ì„ í—¤ë“œì…‹", selected: false, value: -1, isEnd: false },
        { name: "ì˜¤ë²„ë” ë°”ì´í¬", selected: false, value: -1, isEnd: false },
        {
          name: "ë‹¤ì´ìŠ¨ í—¤ì–´ë“œë¼ì´ê¸°",
          selected: false,
          value: -1,
          isEnd: false,
        },
        {
          name: "ë¯¸ë‹‰ìŠ¤ ìŒì‹ë¬¼ ì²˜ë¦¬ê¸°",
          selected: false,
          value: -1,
          isEnd: false,
        },
        {
          name: "ì‚¼ì„± ì¹´ìš´í„°íƒ‘ ì‹ê¸°ì„¸ì²™ê¸°",
          selected: false,
          value: -1,
          isEnd: false,
        },
        {
          name: "LG ì½”ë“œì œë¡œ R5 ë¡œë´‡ì²­ì†Œê¸°",
          selected: false,
          value: -1,
          isEnd: false,
        },
        { name: "ì• í”Œì›Œì¹˜ 10", selected: false, value: -1, isEnd: false },
        { name: "í”Œë ˆì´ìŠ¤í…Œì´ì…˜5", selected: false, value: -1, isEnd: false },
        { name: "ë©”íƒ€í€˜ìŠ¤íŠ¸3 VR", selected: false, value: -1, isEnd: false },
        {
          name: "ë‹¤ì´ìŠ¨ ë¬´ì„  ì²­ì†Œê¸°",
          selected: false,
          value: -1,
          isEnd: false,
        },
        { name: "ì‚¼ì²œë¦¬ ì „ê¸°ìì „ê±°", selected: false, value: -1, isEnd: false },
        { name: "2ì¸ ì œì£¼ë” ì—¬í–‰ê¶Œ", selected: false, value: -1, isEnd: false },
        { name: "ê°¤ëŸ­ì‹œ íƒ­ (S10)", selected: false, value: -1, isEnd: false },
        { name: "ê°¤ëŸ­ì‹œ S25", selected: false, value: -1, isEnd: false },
        {
          name: "LG íŠ¸ë¡¬ ì˜¤ë¸Œì œì»¬ë ‰ì…˜ ê±´ì¡°ê¸°",
          selected: false,
          value: -1,
          isEnd: false,
        },
        { name: "LG ìŠ¤íƒ ë°”ì´ë¯¸2", selected: false, value: -1, isEnd: false },
        { name: "ì•„ì´í°16", selected: false, value: -1, isEnd: false },
        { name: "ì•„ì´íŒ¨ë“œ ì—ì–´11", selected: false, value: -1, isEnd: false },
        {
          name: "ì°¬ì¡° : ì†ìŠ¤íƒ€ìƒ",
          selected: false,
          value: -1,
          special: true,
          isEnd: false,
        },
        {
          name: "ì°¬ì¡° : í•œì§€ë‹ˆì–´ìŠ¤ìƒ",
          selected: false,
          value: -1,
          special: true,
          isEnd: false,
        },
      ];

      // ë‹¨ì–´ ë°°ì—´ì„ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ ì…ë‹ˆë‹¤.
      function buildWordsArray() {
        wordsArray.splice(0, wordsArray.length);
        for (let i = 0; i < wordsArrayCount; i++) {
          const isEnded = endedNumberArray.find((number) => number === i);
          if (isEnded == undefined) {
            wordsArray.push({
              key: i,
              value: `${i + 1}`,
            });
          }
        }
      }

      //ì¢Œì¸¡ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ ì…ë‹ˆë‹¤.
      function buildGiftContainerItem() {
        giftContainer.innerHTML = ""; // Clear
        giftBoxes.forEach((item) => {
          const newChild = document.createElement("div");
          newChild.textContent = item.name;
          newChild.classList.add("gift-item");
          if (item.special) {
            //íŠ¹ë³„í•œ ì•„ì´í…œì¸ ê²½ìš°
            newChild.classList.add("special");
          }
          if (item.isEnd) {
            newChild.classList.add("selected-completed");
          }
          newChild.addEventListener("click", () => {
            const childList = document.getElementsByClassName("gift-item");
            if (rolling) return;
            for (let i = 0; i < childList.length; i++) {
              childList[i].classList.remove("selected");
            }
            giftBoxes.forEach((item) => {
              item.selected = false;
            });
            if (item.selected) {
              item.selected = false;
              newChild.classList.remove("selected");
            } else {
              item.selected = true;
              newChild.classList.add("selected");
            }
          });
          if (item.isEnd) {
            newChild.textContent = `${item.name} (${item.value + 1}ë²ˆ)`;
          }
          giftContainer.appendChild(newChild);
        });
      }

      function clearSlot() {
        while (slot.firstChild) {
          slot.removeChild(slot.firstChild);
        }
      }

      function showItem(word, isFinal = false) {
        clearSlot();
        const newChild = document.createElement("div");
        newChild.textContent = word;
        newChild.className = "slot-item" + (isFinal ? " final" : "");
        slot.appendChild(newChild);
      }

      function rollLoop() {
        if (!rolling) return;
        const randomWord =
          wordsArray[Math.floor(Math.random() * wordsArray.length)].value;
        showItem(randomWord);
        currentSpeed = Math.max(currentSpeed * 0.9, 50); // ë” ë¹¨ë¼ì§€ë„ë¡ ì„¤ì •
        currentTimeout = setTimeout(rollLoop, currentSpeed);
      }

      function startRolling() {
        if (rolling) return;
        const selectedItems = giftBoxes.filter((item) => item.selected);
        const isEndedLength = endedNumberArray.length == wordsArrayCount;
        if (isEndedLength) {
          showToast("ëª¨ë“  ìƒí’ˆì´ ì¶”ì²¨ë˜ì—ˆìŠµë‹ˆë‹¤.");
          return;
        }
        if (selectedItems.length === 0) {
          showToast("ìƒí’ˆì„ ì„ íƒí•˜ì—¬ ì£¼ì„¸ìš”.");
          return;
        }
        beforeStart.style.display = "none";
        rolling = true;
        currentSpeed = firstSpeed;
        rollLoop();
      }

      function stopRolling() {
        try {
          if (isStopping) return; // ë©ˆì¶”ëŠ” ì¤‘ì´ë©´ ë¦¬í„´
          isStopping = true; // ë©ˆì¶”ëŠ” ì¤‘ìœ¼ë¡œ ì„¤ì •
          clearTimeout(currentTimeout);
          let itemKey = Math.floor(Math.random() * wordsArrayCount);
          let preventLoop = 0;
          let isEnded = endedNumberArray.find((number) => number === itemKey);
          while (isEnded != undefined) {
            itemKey = Math.floor(Math.random() * wordsArrayCount);
            isEnded = endedNumberArray.find((number) => number === itemKey);
            preventLoop++;
            if (preventLoop > 50000) {
              break;
            }
          }
          giftBoxes.forEach((item) => {
            if (item.selected) {
              item.value = itemKey;
              item.isEnd = true;
              console.log(item);
            }
          });
          endedNumberArray.push(itemKey);
          const finalWord = wordsArray.find((item) => item.key === itemKey);
          setDataForLocalStorage(giftBoxes);
          setDataForLocalStorage(endedNumberArray, "endNumbers");
          showItem(finalWord.value, true);
          buildGiftContainerItem();
          buildWordsArray();
        } catch (error) {
          console.error("Error in stopRolling:", error);
          showToast("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        } finally {
          giftBoxes.forEach((item) => {
            item.selected = false; // ì„ íƒëœ ìƒíƒœ ì´ˆê¸°í™”
          });
          setTimeout(() => {
            rolling = false;
            isStopping = false; // ë©ˆì¶¤ ì•¡ì…˜ì´ ëë‚¬ìŒì„ í‘œì‹œ
          }, 300);
        }
      }

      function fireConfetti() {
        const shapes = ["circle", "square", "triangle", "star"];
        const confettiColors = [
          "#00ff99",
          "#ffff33",
          "#33ccff",
          "#ff6699",
          "#ff3cac",
          "#ffdd00",
        ];

        for (let i = 0; i < 200; i++) {
          const len = Math.floor(Math.random() * 100);
          setTimeout(() => {
            const timeout = Math.floor(Math.random() * 1000);
            const conf = document.createElement("div");
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            conf.className = `confetti-shape ${shape}`;
            conf.style.position = "absolute";
            conf.style.left = Math.random() * 100 + "%";
            conf.style.top = Math.random() * 10 + "%";
            conf.style.width = "12px";
            conf.style.height = "12px";
            conf.style.backgroundColor =
              confettiColors[Math.floor(Math.random() * confettiColors.length)];
            conf.style.opacity = 1;
            conf.style.animation = `confettiFall 1.8s ease-out forwards`;
            document.body.appendChild(conf);
            setTimeout(() => conf.remove(), timeout);
          }, len);
        }
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          if (!rolling) {
            startRolling();
          } else {
            stopRolling();
            let fireConfettiCount = 0;
            const fireConfettiInterval = setInterval(() => {
              fireConfettiCount++;
              if (fireConfettiCount > 3) {
                clearInterval(fireConfettiInterval);
              }
              fireConfetti();
            }, 250);
            showCongrats();
          }
        }
      });

      function showCongrats() {
        const el = document.getElementById("congrats");
        el.classList.add("show");
        // 3ì´ˆ í›„ ì‚¬ë¼ì§€ê²Œ
        setTimeout(() => {
          el.classList.remove("show");
        }, 3000);
      }

      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìƒì„± í•¨ìˆ˜
      function showToast(message, duration = 1000) {
        const toast = document.createElement("div");
        toast.textContent = message;
        toast.classList.add("toast-item");
        // í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
        toastContainer.appendChild(toast);
        // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
        setTimeout(() => {
          toast.style.opacity = "1";
        }, 100);

        // // ì§€ì •ëœ ì‹œê°„ í›„ ì‚­ì œ
        setTimeout(() => {
          toast.style.opacity = "0";
          setTimeout(() => {
            toast.remove();
          }, 300); // í˜ì´ë“œì•„ì›ƒ ì‹œê°„
        }, duration);
      }

      //ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥í•˜ëŠ” í•¨ìˆ˜
      function setDataForLocalStorage(newItem, name) {
        localStorage.setItem(name || "savedData", JSON.stringify(newItem));
      }
      //ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
      function getDataForLocalStorage(name) {
        return JSON.parse(localStorage.getItem(name || "savedData")) || null;
      }

      //ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜(ìƒí’ˆ ë°°ì—´ê³¼ ì´ë¯¸ ì¶”ì²¨í•œ ë²ˆí˜¸ì˜ ë°°ì—´)
      function initGiftBoxes() {
        const savedData = getDataForLocalStorage();
        const savedEndData = getDataForLocalStorage("endNumbers");
        if (savedEndData) {
          endedNumberArray.splice(0, endedNumberArray.length, ...savedEndData);
        }
        if (savedData) {
          giftBoxes.splice(0, giftBoxes.length, ...savedData);
        }
      }
      initGiftBoxes();
      buildWordsArray();
      buildGiftContainerItem();
    </script>
  </body>
</html>
